.PHONY: download-test-vectors clean-vectors test

FIXTURES_FILE := .fixtures_url
SPECTEST_ARTIFACT := tests.tar.gz
SPECTEST_VECTORS_DIR := vectors
TMP_DIR := tmp

SPECTEST_URL := $(shell cat $(FIXTURES_FILE))

$(SPECTEST_ARTIFACT): $(FIXTURES_FILE)
	$(MAKE) clean-vectors
	curl -L -o $(SPECTEST_ARTIFACT) $(SPECTEST_URL)

$(SPECTEST_VECTORS_DIR): $(SPECTEST_ARTIFACT)
	mkdir -p $(SPECTEST_VECTORS_DIR) $(TMP_DIR)
	tar -xzf $(SPECTEST_ARTIFACT) -C $(TMP_DIR)
	rm -rf $(SPECTEST_VECTORS_DIR)/*
	mv $(TMP_DIR)/fixtures/blockchain_tests/* $(SPECTEST_VECTORS_DIR)
	rm -rf $(TMP_DIR)

download-test-vectors: $(SPECTEST_VECTORS_DIR) ## üì• Download test vectors

clean-vectors: ## üóëÔ∏è  Clean test vectors
	rm -rf $(SPECTEST_VECTORS_DIR)
	rm -f $(SPECTEST_ARTIFACT)
	rm -rf $(TMP_DIR)

test: $(SPECTEST_VECTORS_DIR) ## üß™ Run blockchain tests
	cargo test
