# This file is based upon `assertoor-tests` stability check file:
#   https://github.com/ethpandaops/assertoor-test/blob/master/assertoor-tests/stability-check.yaml
#
# We removed the consensus checks to keep it minimal. The checks removed were:
#   - check_consensus_finality
#   - check_consensus_attestation_stats
#   - check_consensus_reorgs
#   - check_consensus_forks

id: el-stability-check
name: "Check Execution Stability"
timeout: 2h
tasks:
- name: check_clients_are_healthy
  title: "Check if at least one client is ready"
  timeout: 2m

- name: run_tasks_concurrent
  title: "Check if all EL & CL clients are synced and they were able to propose blocks"
  timeout: 5m
  config:
    tasks:
    - name: check_consensus_sync_status
      title: "Check if CL clients are synced"
    - name: check_execution_sync_status
      title: "Check if EL clients are synced"
    - name: check_consensus_block_proposals
      title: "Wait for block proposal from prysm-geth"
      configVars:
        validatorNamePattern: "*prysm*"
    - name: check_consensus_block_proposals
      title: "Wait for block proposal from lighthouse-ethereumrust"
      configVars:
        validatorNamePattern: "*lighthouse*"

- name: run_task_matrix
  title: "Check block proposals from all client pairs"
  configVars:
    matrixValues: "validatorPairNames"
  config:
    runConcurrent: true
    matrixVar: "validatorPairName"
    task:
      name: check_consensus_block_proposals
      title: "Wait for block proposal from ${validatorPairName}"
      configVars:
        validatorNamePattern: "validatorPairName"
