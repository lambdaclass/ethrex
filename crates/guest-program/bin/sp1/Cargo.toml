[package]
name = "ethrex-guest-sp1"
version = "9.0.0"
edition = "2024"
license = "MIT OR Apache-2.0"

[workspace]

[profile.release]
lto = "thin"
codegen-units = 1

[dependencies]
sp1-zkvm = { version = "=6.0.0-rc.1" }
rkyv = { version = "0.8.10", features = ["std", "unaligned"] }

ethrex-guest-program = { path = "../../", features = ["sp1-cycles"] }

ethrex-vm = { path = "../../../vm", default-features = false, features = [
    "sp1",
] }

[patch.crates-io]
sha2-v0-10-9 = { git = "https://github.com/sp1-patches/RustCrypto-hashes", package = "sha2", tag = "patch-sha2-0.10.9-sp1-6.0.0-rc.1" }
sha3-v0-10-8 = { git = "https://github.com/sp1-patches/RustCrypto-hashes", package = "sha3", tag = "patch-sha3-0.10.8-sp1-6.0.0-rc.1" }
crypto-bigint = { git = "https://github.com/sp1-patches/RustCrypto-bigint", tag = "patch-0.5.5-sp1-6.0.0-rc.1" }
tiny-keccak = { git = "https://github.com/sp1-patches/tiny-keccak", tag = "patch-2.0.2-sp1-6.0.0-rc.1" }
p256 = { git = "https://github.com/sp1-patches/elliptic-curves", tag = "patch-p256-13.2-sp1-6.0.0-rc.1" }
secp256k1 = { git = "https://github.com/sp1-patches/rust-secp256k1", tag = "patch-0.30.0-sp1-6.0.0-rc.1" }
# NOTE: The ecdsa patch is removed for v6. The k256 RC patch brings its own ecdsa from git
# (sp1-skip-verify-on-recovery tag), and the v4.1.0 ecdsa patch adds HIGH_S_ALLOWED to
# VerifyPrimitive which breaks the p256 RC patch's empty impl. Vanilla crates.io ecdsa works fine.
k256 = { git = "https://github.com/sp1-patches/elliptic-curves", tag = "patch-k256-13.4-sp1-6.0.0-rc.1" }
# WORKAROUND: The RC tag (patch-0.6.0-sp1-6.0.0-rc.1) renamed the package to substrate-bn-succinct-rs,
# which breaks [patch.crates-io] matching. The non-RC tag has sp1-lib = "6.0.0" which doesn't resolve
# with the RC pre-release. We use the non-RC tag + manually fix sp1-lib version in the local cargo
# git cache (~/.cargo/git/checkouts/bn-*/3b9807c/Cargo.toml). Once SP1 v6.0.0 stable is released,
# switch to the stable tag and remove this workaround.
substrate-bn = { git = "https://github.com/sp1-patches/bn", tag = "patch-0.6.0-sp1-6.0.0" }
# The v6.0.0 patches depend on sp1-lib ^6.0.0, which doesn't match the pre-release 6.0.0-rc.1
# on crates.io. We patch sp1-lib to the RC tag from the sp1 repo to resolve this.
sp1-lib = { git = "https://github.com/succinctlabs/sp1.git", tag = "v6.0.0-rc.1" }

[patch."https://github.com/lambdaclass/bls12_381"]
bls12_381 = { git = "https://github.com/lambdaclass/bls12_381-patch/", branch = "expose-fp-struct" }

[features]
l2 = ["ethrex-guest-program/l2"]
