use bytes::Bytes;
use ethrex_levm::{call_frame::CallFrame, errors::TxResult, utils::new_vm_with_bytecode};
use revm::{
    db::BenchmarkDB,
    primitives::{address, Bytecode, TransactTo},
    Evm,
};
use std::hint::black_box;

pub const FIBONACCI_BYTECODE: &str =
    "5f355f60015b8215601a578181019150909160019003916005565b9150505f5260205ff3";
pub const FACTORIAL_BYTECODE: &str =
    "5f355f60015b8215601b57906001018091029160019003916005565b9150505f5260205ff3";

pub const TEN_THOUSAND_HASHES_BYTECODE: &str =
    "608060405234801561001057600080fd5b50610178806100206000396000f3fe60806040523480156100105760008\
    0fd5b506004361061002b5760003560e01c806330627b7c14610030575b600080fd5b61003861003a565b005b60005\
    b614e20811015610082578060405160200161005891906100b0565b604051602081830303815290604052805190602\
    0012050808061007a906100fa565b91505061003d565b50565b6000819050919050565b6000819050919050565b610\
    0aa6100a582610085565b61008f565b82525050565b60006100bc8284610099565b602082019150819050929150505\
    65b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000f\
    d5b600061010582610085565b91507ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff\
    f8203610137576101366100cb565b5b60018201905091905056fea26469706673582212201329a20baecd741908b58\
    b3870fdca30840867c48fce82550a1330eb85b5c7cf64736f6c63430008110033";

pub const SNAILTRACER_BYTECODE: &str =
    "608060405234801561001057600080fd5b50615414806100206000396000f3006080604052600436106100625760\
    00357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806330627b7c1\
    461006757806375ac892a1461016c578063784f13661461021c578063c29436011461034b575b600080fd5b348015\
    61007357600080fd5b5061007c6103f1565b60405180847efffffffffffffffffffffffffffffffffffffffffffff\
    fffffffffffffffff19167effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff191681526\
    02001837effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff19167efffffffffffffffff\
    fffffffffffffffffffffffffffffffffffffffffffff19168152602001827effffffffffffffffffffffffffffff\
    ffffffffffffffffffffffffffffffff19167efffffffffffffffffffffffffffffffffffffffffffffffffffffff\
    fffffff19168152602001935050505060405180910390f35b34801561017857600080fd5b506101a1600480360381\
    0190808035906020019092919080359060200190929190505050613348565b60405180806020018281038252838181\
    51815260200191508051906020019080838360005b838110156101e15780820151818401526020810190506101c656\
    5b50505050905090810190601f16801561020e5780820380516001836020036101000a031916815260200191505b50\
    9250505060405180910390f35b34801561022857600080fd5b5061025b600480360381019080803590602001909291\
    9080359060200190929190803590602001909291905050506136b9565b60405180847effffffffffffffffffffffff\
    ffffffffffffffffffffffffffffffffffffff19167effffffffffffffffffffffffffffffffffffffffffffffffff\
    ffffffffffff19168152602001837effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff19\
    167effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff19168152602001827effffffffff\
    ffffffffffffffffffffffffffffffffffffffffffffffffffff19167effffffffffffffffffffffffffffffffffff\
    ffffffffffffffffffffffffff19168152602001935050505060405180910390f35b34801561035757600080fd5b50\
    61037660048036038101908080359060200190929190505050613758565b6040518080602001828103825283818151\
    815260200191508051906020019080838360005b838110156103b657808201518184015260208101905061039b565\
    b50505050905090810190601f1680156103e35780820380516001836020036101000a031916815260200191505b509\
    250505060405180910390f35b6000806000806103ff6152b0565b61040761531e565b6104006000819055506103006\
    001819055506080604051908101604052806060604051908101604052806302faf0808152602001630319750081526\
    0200163119e7f8081525081526020016104b7606060405190810160405280600081526020017ffffffffffffffffff\
    fffffffffffffffffffffffffffffffffffffffffff598c81526020017ffffffffffffffffffffffffffffffffffff\
    ffffffffffffffffffffffff0bdc0815250613aea565b8152602001600081526020016000151581525060036000820\
    1518160000160008201518160000155602082015181600101556040820151816002015550506020820151816003016\
    0008201518160000155602082015181600101556040820151816002015550506040820151816006015560608201518\
    160070160006101000a81548160ff0219169083151502179055509050506060604051908101604052806001546207d\
    5dc6000540281151561056b57fe5b058152602001600081526020016000815250600b6000820151816000015560208\
    2015181600101556040820151816002015590505061062261061961061061060b600b6060604051908101604052908\
    1600082015481526020016001820154815260200160028201548152505060038001606060405190810160405290816\
    000820154815260200160018201548152602001600282015481525050613b81565b613aea565b6207d5dc613bef565\
    b620f4240613c2d565b600e6000820151816000015560208201518160010155604082015181600201559050506011\
    60a06040519081016040528064174876e8008152602001606060405190810160405280641748862a40815260200163\
    026e8f0081526020016304dd1e00815250815260200160606040519081016040528060008152602001600081526020\
    0160008152508152602001606060405190810160405280620b71b081526020016203d09081526020016203d0908152\
    508152602001600060028111156106e757fe5b8152509080600181540180825580915050906001820390600052602\
    060002090600b020160009091929091909150600082015181600001556020820151816001016000820151816000015\
    5602082015181600101556040820151816002015550506040820151816004016000820151816000015560208201518\
    1600101556040820151816002015550506060820151816007016000820151816000015560208201518160010155604\
    082015181600201555050608082015181600a0160006101000a81548160ff021916908360028111156107be57fe5b0\
    217905550505050601160a06040519081016040528064174876e80081526020016060604051908101604052807ffff\
    fffffffffffffffffffffffffffffffffffffffffffffffffffe8bd6fb6c0815260200163026e8f008152602001630\
    4dd1e00815250815260200160606040519081016040528060008152602001600081526020016000815250815260200\
    16060604051908101604052806203d09081526020016203d0908152602001620b71b08152508152602001600060028\
    1111561088357fe5b8152509080600181540180825580915050906001820390600052602060002090600b020160009\
    0919290919091506000820151816000015560208201518160010160008201518160000155602082015181600101556\
    0408201518160020155505060408201518160040160008201518160000155602082015181600101556040820151816\
    0020155505060608201518160070160008201518160000155602082015181600101556040820151816002015550506\
    08082015181600a0160006101000a81548160ff0219169083600281111561095a57fe5b0217905550505050601160a\
    06040519081016040528064174876e80081526020016060604051908101604052806302faf080815260200163026e8\
    f00815260200164174876e800815250815260200160606040519081016040528060008152602001600081526020016\
    0008152508152602001606060405190810160405280620b71b08152602001620b71b08152602001620b71b08152508\
    15260200160006002811115610a0457fe5b81525090806001815401808255809150509060018203906000526020600\
    02090600b0201600090919290919091506000820151816000015560208201518160010160008201518160000155602\
    0820151816001015560408201518160020155505060408201518160040160008201518160000155602082015181600\
    1015560408201518160020155505060608201518160070160008201518160000155602082015181600101556040820\
    15181600201555050608082015181600a0160006101000a81548160ff02191690836002811115610adb57fe5b02179\
    05550505050601160a06040519081016040528064174876e80081526020016060604051908101604052806302faf08\
    0815260200163026e8f0081526020017fffffffffffffffffffffffffffffffffffffffffffffffffffffffe8c1ab1\
    6808152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606\
    06040519081016040528060008152602001600081526020016000815250815260200160006002811115610b9a57fe5\
    b8152509080600181540180825580915050906001820390600052602060002090600b0201600090919290919091506\
    0008201518160000155602082015181600101600082015181600001556020820151816001015560408201518160020\
    1555050604082015181600401600082015181600001556020820151816001015560408201518160020155505060608\
    20151816007016000820151816000015560208201518160010155604082015181600201555050608082015181600a0\
    160006101000a81548160ff02191690836002811115610c7157fe5b0217905550505050601160a0604051908101604\
    0528064174876e80081526020016060604051908101604052806302faf080815260200164174876e80081526020016\
    304dd1e008152508152602001606060405190810160405280600081526020016000815260200160008152508152602\
    001606060405190810160405280620b71b08152602001620b71b08152602001620b71b081525081526020016000600\
    2811115610d1b57fe5b8152509080600181540180825580915050906001820390600052602060002090600b0201600\
    0909192909190915060008201518160000155602082015181600101600082015181600001556020820151816001015\
    5604082015181600201555050604082015181600401600082015181600001556020820151816001015560408201518\
    1600201555050606082015181600701600082015181600001556020820151816001015560408201518160020155505\
    0608082015181600a0160006101000a81548160ff02191690836002811115610df257fe5b021790555050505060116\
    0a06040519081016040528064174876e80081526020016060604051908101604052806302faf08081526020017ffff\
    fffffffffffffffffffffffffffffffffffffffffffffffffffe8bc66360081526020016304dd1e008152508152602\
    0016060604051908101604052806000815260200160008152602001600081525081526020016060604051908101604\
    05280620b71b08152602001620b71b08152602001620b71b0815250815260200160006002811115610eb757fe5b815\
    2509080600181540180825580915050906001820390600052602060002090600b02016000909192909190915060008\
    2015181600001556020820151816001016000820151816000015560208201518160010155604082015181600201555\
    0506040820151816004016000820151816000015560208201518160010155604082015181600201555050606082015\
    1816007016000820151816000015560208201518160010155604082015181600201555050608082015181600a01600\
    06101000a81548160ff02191690836002811115610f8e57fe5b0217905550505050601160a06040519081016040528\
    062fbc520815260200160606040519081016040528063019bfcc0815260200162fbc52081526020016302cd29c0815\
    2508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405\
    190810160405280620f3e588152602001620f3e588152602001620f3e58815250815260200160016002811115611034\
    57fe5b8152509080600181540180825580915050906001820390600052602060002090600b02016000909192909190\
    9150600082015181600001556020820151816001016000820151816000015560208201518160010155604082015181\
    6002015550506040820151816004016000820151816000015560208201518160010155604082015181600201555050\
    6060820151816007016000820151816000015560208201518160010155604082015181600201555050608082015181\
    600a0160006101000a81548160ff0219169083600281111561110b57fe5b0217905550505050601160a06040519081\
    01604052806323c3460081526020016060604051908101604052806302faf080815260200163289c45508152602001\
    6304dd1e00815250815260200160606040519081016040528062b71b00815260200162b71b00815260200162b71b00\
    8152508152602001606060405190810160405280600081526020016000815260200160008152508152602001600060\
    028111156111b357fe5b8152509080600181540180825580915050906001820390600052602060002090600b020160\
    0090919290919091506000820151816000015560208201518160010160008201518160000155602082015181600101\
    5560408201518160020155505060408201518160040160008201518160000155602082015181600101556040820151\
    816002015550506060820151816007016000820151816000015560208201518160010155604082015181600201555050608082015181600a0160006101000a81548160ff0219169083600281111561128a57fe5b0217905550505050601260e06040519081016040528060606040519081016040528063035e1f208152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016305a1f4a08152508152602001606060405190810160405280630459e44081526020016302f34f6081526020016304a62f808152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e588152508152602001600160028111156113a657fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff021916908360028111156114ee57fe5b0217905550505050601260e06040519081016040528060606040519081016040528063035e1f20815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001600081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016305a1f4a08152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e5881525081526020016001600281111561160757fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff0219169083600281111561174f57fe5b0217905550505050601260e060405190810160405280606060405190810160405280630555a9608152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e44081526020016302f34f6081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016305a1f4a08152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e5881525081526020016001600281111561186b57fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff021916908360028111156119b357fe5b0217905550505050601260e060405190810160405280606060405190810160405280630555a960815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016305a1f4a08152508152602001606060405190810160405280630459e4408152602001600081526020016304a62f808152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e58815250815260200160016002811115611acc57fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff02191690836002811115611c1457fe5b0217905550505050601260e06040519081016040528060606040519081016040528063035e1f208152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e44081526020016302f34f6081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016303aa6a608152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e58815250815260200160016002811115611d3057fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff02191690836002811115611e7857fe5b0217905550505050601260e06040519081016040528060606040519081016040528063035e1f20815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016303aa6a608152508152602001606060405190810160405280630459e4408152602001600081526020016304a62f808152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e58815250815260200160016002811115611f9157fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff021916908360028111156120d957fe5b0217905550505050601260e060405190810160405280606060405190810160405280630555a9608152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016303aa6a608152508152602001606060405190810160405280630459e44081526020016302f34f6081526020016304a62f808152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e588152508152602001600160028111156121f557fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff0219169083600281111561233d57fe5b0217905550505050601260e060405190810160405280606060405190810160405280630555a960815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001600081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016303aa6a608152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e5881525081526020016001600281111561245657fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff0219169083600281111561259e57fe5b0217905550505050601260e06040519081016040528060606040519081016040528063035e1f208152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016303aa6a608152508152602001606060405190810160405280630555a9608152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e588152508152602001600160028111156126ba57fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff0219169083600281111561280257fe5b0217905550505050601260e06040519081016040528060606040519081016040528063035e1f208152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630555a9608152602001630188c2e081526020016304a62f808152508152602001606060405190810160405280630459e4408152602001630188c2e081526020016305a1f4a08152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e5881525081526020016001600281111561291e57fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff02191690836002811115612a6657fe5b0217905550505050601260e06040519081016040528060606040519081016040528063035e1f20815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630555a960815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016303aa6a608152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e58815250815260200160016002811115612b8257fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff02191690836002811115612cca57fe5b0217905550505050601260e06040519081016040528060606040519081016040528063035e1f20815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280630459e440815260200163016a8c8081526020016305a1f4a08152508152602001606060405190810160405280630555a960815260200163016a8c8081526020016304a62f808152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280600081526020016000815260200160008152508152602001606060405190810160405280620f3e588152602001620f3e588152602001620f3e58815250815260200160016002811115612de657fe5b815250908060018154018082558091505090600182039060005260206000209060130201600090919290919091506000820151816000016000820151816000015560208201518160010155604082015181600201555050602082015181600301600082015181600001556020820151816001015560408201518160020155505060408201518160060160008201518160000155602082015181600101556040820151816002015550506060820151816009016000820151816000015560208201518160010155604082015181600201555050608082015181600c01600082015181600001556020820151816001015560408201518160020155505060a082015181600f01600082015181600001556020820151816001015560408201518160020155505060c08201518160120160006101000a81548160ff02191690836002811115612f2e57fe5b0217905550505050600092505b60128054905083101561315457601283815481101515612f5757fe5b906000526020600020906013020160e06040519081016040529081600082016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600382016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600682016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600982016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600c82016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600f820160606040519081016040529081600082015481526020016001820154815260200160028201548152505081526020016012820160009054906101000a900460ff1660028111156130c157fe5b60028111156130cc57fe5b8152505091506131066131016130ea84602001518560000151613c86565b6130fc85604001518660000151613c86565b613b81565b613aea565b60128481548110151561311557fe5b90600052602060002090601302016009016000820151816000015560208201518160010155604082015181600201559050508280600101935050612f3b565b6060604051908101604052806001546207d5dc6000540281151561317457fe5b058152602001600081526020016000815250600b60008201518160000155602082015181600101556040820151816002015590505061322b613222613219613214600b60606040519081016040529081600082015481526020016001820154815260200160028201548152505060038001606060405190810160405290816000820154815260200160018201548152602001600282015481525050613b81565b613aea565b6207d5dc613bef565b620f4240613c2d565b600e600082015181600001556020820151816001015560408201518160020155905050613267816132626102006101806008613cd0565b613f18565b90506132828161327d61014561021c6008613cd0565b613f18565b905061329b81613296610258806008613cd0565b613f18565b90506132b6816132b161020a61020c6008613cd0565b613f18565b90506132c3816004613c2d565b905080600001517f01000000000000000000000000000000000000000000000000000000000000000281602001517f01000000000000000000000000000000000000000000000000000000000000000282604001517f010000000000000000000000000000000000000000000000000000000000000002955095509550505050909192565b6060600061335461531e565b600091505b6000548212156136145761336e828686613cd0565b9050600281600001517f01000000000000000000000000000000000000000000000000000000000000000290808054603f811680603e81146133cc576002830184556001831615156133be578192505b6001600284040193506133e6565b83600052602060002060ff19841681556041855560209450505b505050906001820381546001161561340d5790600052602060002090602091828204019190065b90919290919091601f036101000a81548160ff021916907f01000000000000000000000000000000000000000000000000000000000000008404021790555050600281602001517f01000000000000000000000000000000000000000000000000000000000000000290808054603f811680603e81146134a95760028301845560018316151561349b578192505b6001600284040193506134c3565b83600052602060002060ff19841681556041855560209450505b50505090600182038154600116156134ea5790600052602060002090602091828204019190065b90919290919091601f036101000a81548160ff021916907f01000000000000000000000000000000000000000000000000000000000000008404021790555050600281604001517f01000000000000000000000000000000000000000000000000000000000000000290808054603f811680603e811461358657600283018455600183161515613578578192505b6001600284040193506135a0565b83600052602060002060ff19841681556041855560209450505b50505090600182038154600116156135c75790600052602060002090602091828204019190065b90919290919091601f036101000a81548160ff021916907f010000000000000000000000000000000000000000000000000000000000000084040217905550508180600101925050613359565b60028054600181600116156101000203166002900480601f0160208091040260200160405190\
    810160405280929190818152602001828054600181600116156101000203166002900480156136aa5780601f1061367f576101008083540402835291602001916136aa565b820191906000526020600020905b81548152906001019060200180831161368d57829003601f168201915b50505050509250505092915050565b60008060006136c661531e565b6136d1878787613cd0565b905080600001517f01000000000000000000000000000000000000000000000000000000000000000281602001517f01000000000000000000000000000000000000000000000000000000000000000282604001517f0100000000000000000000000000000000000000000000000000000000000000029350935093505093509350939050565b606060008061376561531e565b600180540392505b600083121515613a4557600091505b600054821215613a3757613791828487613cd0565b9050600281600001517f01000000000000000000000000000000000000000000000000000000000000000290808054603f811680603e81146137ef576002830184556001831615156137e1578192505b600160028404019350613809565b83600052602060002060ff19841681556041855560209450505b50505090600182038154600116156138305790600052602060002090602091828204019190065b90919290919091601f036101000a81548160ff021916907f01000000000000000000000000000000000000000000000000000000000000008404021790555050600281602001517f01000000000000000000000000000000000000000000000000000000000000000290808054603f811680603e81146138cc576002830184556001831615156138be578192505b6001600284040193506138e6565b83600052602060002060ff19841681556041855560209450505b505050906001820381546001161561390d5790600052602060002090602091828204019190065b90919290919091601f036101000a81548160ff021916907f01000000000000000000000000000000000000000000000000000000000000008404021790555050600281604001517f01000000000000000000000000000000000000000000000000000000000000000290808054603f811680603e81146139a95760028301845560018316151561399b578192505b6001600284040193506139c3565b83600052602060002060ff19841681556041855560209450505b50505090600182038154600116156139ea5790600052602060002090602091828204019190065b90919290919091601f036101000a81548160ff021916907f01000000000000000000000000000000000000000000000000000000000000008404021790555050818060010192505061377c565b82806001900393505061376d565b60028054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015613adb5780601f10613ab057610100808354040283529160200191613adb565b820191906000526020600020905b815481529060010190602001808311613abe57829003601f168201915b50505050509350505050919050565b613af261531e565b6000613b1f8360400151846040015102846020015185602001510285600001518660000151020101613f62565b905060606040519081016040528082620f4240866000015102811515613b4157fe5b05815260200182620f4240866020015102811515613b5b57fe5b05815260200182620f4240866040015102811515613b7557fe5b05815250915050919050565b613b8961531e565b60606040519081016040528083602001518560400151028460400151866020015102038152602001836040015185600001510284600001518660400151020381526020018360000151856020015102846020015186600001510203815250905092915050565b613bf761531e565b60606040519081016040528084600001518402815260200184602001518402815260200184604001518402815250905092915050565b613c3561531e565b606060405190810160405280838560000151811515613c5057fe5b058152602001838560200151811515613c6557fe5b058152602001838560400151811515613c7a57fe5b05815250905092915050565b613c8e61531e565b60606040519081016040528083600001518560000151038152602001836020015185602001510381526020018360400151856040015103815250905092915050565b613cd861531e565b6000613ce261531e565b613cea615340565b86600054870201601360006101000a81548163ffffffff021916908363ffffffff160217905550613d1961531e565b9350600092505b84831215613eed57613e50613e1d613e14613da0600b6060604051908101604052908160008201548152602001600182015481526020016002820154815250506207a1206000546207a120613d73613fad565b63ffffffff16811515613d8257fe5b0663ffffffff168e620f42400201811515613d9957fe5b0503613bef565b613e0f600e6060604051908101604052908160008201548152602001600182015481526020016002820154815250506207a1206001546207a120613de2613fad565b63ffffffff16811515613df157fe5b0663ffffffff168e620f42400201811515613e0857fe5b0503613bef565b613f18565b620f4240613c2d565b60038001606060405190810160405290816000820154815260200160018201548152602001600282015481525050613f18565b9150608060405190810160405280613ea06003600001606060405190810160405290816000820154815260200160018201548152602001600282015481525050613e9b86608c613bef565b613f18565b8152602001613eae84613aea565b815260200160008152602001600015158152509050613ede84613ed9613ed384614004565b88613c2d565b613f18565b93508280600101935050613d20565b613f0c613f03613efc86614493565b60ff613bef565b620f4240613c2d565b93505050509392505050565b613f2061531e565b60606040519081016040528083600001518560000151018152602001836020015185602001510181526020018360400151856040015101815250905092915050565b600080600260018401811515613f7457fe5b0590508291505b81811215613fa7578091506002818285811515613f9457fe5b0501811515613f9f57fe5b059050613f7b565b50919050565b6000613039601360009054906101000a900463ffffffff166341c64e6d0201601360006101000a81548163ffffffff021916908363ffffffff160217905550601360009054906101000a900463ffffffff16905090565b61400c61531e565b6000806000614019615378565b6140216152b0565b61402961531e565b61403161531e565b600061403b61531e565b600a8b60400151131561406e57606060405190810160405280600081526020016000815260200160008152509950614485565b6140778b6144e2565b809950819a50829b5050505060008914156140b257606060405190810160405280600081526020016000815260200160008152509950614485565b600060018111156140bf57fe5b8860018111156140cb57fe5b14156141df576011878154811015156140e057fe5b90600052602060002090600b020160a0604051908101604052908160008201548152602001600182016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600482016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600782016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600a820160009054906101000a900460ff1660028111156141bb57fe5b60028111156141c657fe5b8152505095508560600151935085604001519250614378565b6012878154811015156141ee57fe5b906000526020600020906013020160e06040519081016040529081600082016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600382016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600682016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600982016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600c82016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600f820160606040519081016040529081600082015481526020016001820154815260200160028201548152505081526020016012820160009054906101000a900460ff16600281111561435857fe5b600281111561436357fe5b8152505094508460a001519350846080015192505b60019150818460400151131561439057836040015191505b81846020015113156143a457836020015191505b81846040015113156143b857836040015191505b8a60400180518091906001018152505060058b6040015113156144245781620f42406143e2613fad565b63ffffffff168115156143f157fe5b0663ffffffff16121561441b5761441461440e85620f4240613bef565b83613c2d565b9350614423565b829950614485565b5b6000600181111561443157fe5b88600181111561443d57fe5b14156144555761444e8b878b614830565b9050614463565b6144608b868b614919565b90505b6144828361447d6144748785614a07565b620f4240613c2d565b613f18565b99505b505050505050505050919050565b61449b61531e565b6060604051908101604052806144b48460000151614a51565b81526020016144c68460200151614a51565b81526020016144d88460400151614a51565b8152509050919050565b60008060008060008060008060009450600091505b60118054905082101561463f5761460660118381548110151561451657fe5b90600052602060002090600b020160a0604051908101604052908160008201548152602001600182016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600482016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600782016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600a820160009054906101000a900460ff1660028111156145f157fe5b60028111156145fc57fe5b815250508a614a83565b90506000811380156146225750600085148061462157508481125b5b1561463257809450600093508192505b81806001019250506144f7565b600091505b60128054905082101561481b576147e260128381548110151561466357fe5b906000526020600020906013020160e06040519081016040529081600082016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600382016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600682016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600982016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600c82016060604051908101604052908160008201548152602001600182015481526020016002820154815250508152602001600f820160606040519081016040529081600082015481526020016001820154815260200160028201548152505081526020016012820160009054906101000a900460ff1660028111156147cd57fe5b60028111156147d857fe5b815250508a614b35565b90506000811380156147fe575060008514806147fd57508481125b5b1561480e57809450600193508192505b8180600101925050614644565b84848497509750975050505050509193909250565b61483861531e565b61484061531e565b61484861531e565b61486f866000015161486a614861896020015188613bef565b620f4240613c2d565b613f18565b9150614887614882838760200151613c86565b613aea565b90506000600281111561489657fe5b856080015160028111156148a657fe5b14156149025760006148bc828860200151614cc5565b1215156148f0576148ed817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff613bef565b90505b6148fb868383614cf2565b9250614910565b61490d868383614ebc565b92505b50509392505050565b61492161531e565b61492961531e565b600080600061495588600001516149506149478b602001518a613bef565b620f4240613c2d565b613f18565b9350620a2c2a925087606001511561496e576216e36092505b620f424061498488606001518a60200151614cc5565b81151561498d57fe5b0591506000821215156149a1578160000391505b64e8d4a5100082830264e8d4a5100003848502028115156149be57fe5b0564e8d4a5100003905060008112156149e7576149e088858960600151614ebc565b94506149fc565b6149f988858960600151868686614f49565b94505b505050509392505050565b614a0f61531e565b60606040519081016040528083600001518560000151028152602001836020015185602001510281526020018360400151856040015102815250905092915050565b600080821215614a645760009050614a7e565b620f4240821315614a7a57620f42409050614a7e565b8190505b919050565b6000614a8d61531e565b600080614aa286602001518660000151613c86565b9250620f4240614ab6848760200151614cc5565b811515614abf57fe5b0591508560000151866000015102614ad78485614cc5565b838402030190506000811215614af05760009350614b2c565b614af981613f62565b90506103e88183031315614b11578082039350614b2c565b6103e88183011315614b27578082019350614b2c565b600093505b50505092915050565b6000614b3f61531e565b614b4761531e565b614b4f61531e565b6000614b5961531e565b6000614b6361531e565b600080614b788c602001518d60000151613c86565b9850614b8c8c604001518d60000151613c86565b9750614b9c8b6020015189613b81565b9650620f4240614bac8a89614cc5565b811515614bb557fe5b0595507ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc1886138015614be857506103e886125b15614bf65760009950614cb6565b614c088b600001518d60000151613c86565b945085614c158689614cc5565b811515614c1e57fe5b0593506000841280614c325750620f424084135b15614c405760009950614cb6565b614c4a858a613b81565b925085614c5b8c6020015185614cc5565b811515614c6457fe5b0591506000821280614c7a5750620f4240828501135b15614c885760009950614cb6565b85614c938985614cc5565b811515614c9c57fe5b0590506103e8811215614cb25760009950614cb6565b8099505b50505050505050505092915050565b60008160400151836040015102826020015184602001510283600001518560000151020101905092915050565b614cfa61531e565b6000806000614d0761531e565b614d0f61531e565b620f424080614d1c613fad565b63ffffffff16811515614d2b57fe5b0663ffffffff16625fdfb002811515614d4\
    057fe5b059450620f4240614d4f613fad565b63ffffffff16811515614d5e57fe5b0663ffffffff1693506103e8614d7385613f62565b029250620186a0614d8788600001516151a4565b1315614db55760606040519081016040528060008152602001620f4240815260200160008152509150614dd9565b606060405190810160405280620f4240815260200160008152602001600081525091505b614deb614de68389613b81565b613aea565b9150614dff614dfa8884613b81565b613aea565b9050614e78614e73614e53614e2c85620f424088614e1c8c6151c2565b02811515614e2657fe5b05613bef565b614e4e85620f424089614e3e8d6151ea565b02811515614e4857fe5b05613bef565b613f18565b614e6e8a6103e8614e688a620f424003613f62565b02613bef565b613f18565b613aea565b9150614eae6080604051908101604052808a81526020018481526020018b6040015181526020018b606001511515815250614004565b955050505050509392505050565b614ec461531e565b614ecc61531e565b614f09614f048660200151614eff86620f4240614eed898c60200151614cc5565b600202811515614ef957fe5b05613bef565b613c86565b613aea565b9050614f3f6080604051908101604052808681526020018381526020018760400151815260200187606001511515815250614004565b9150509392505050565b614f5161531e565b6000614f5b61531e565b6000807fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff93508a6060015115614f9057600193505b614fe0614fdb614fd2614fa78e602001518c613bef565b614fcd8d614fb48c613f62565b620f42408f8f02811515614fc457fe5b05018a02613bef565b613c86565b620f4240613c2d565b613aea565b925086620f42400191508a606001511515615015576\
    20f4240615003848b614cc5565b81151561500c57fe5b05620f42400391505b6c0c9f2c9cd04674edea400000008283848586620ea600020202020281151561503a57fe5b05619c4001905060028b604001511315156150c7576150926150876080604051908101604052808d81526020018681526020018e6040015181526020018e60600151151515815250614004565b82620f424003613bef565b92506150b1836150ac6150a68e8e8e614ebc565b84613bef565b613f18565b92506150c083620f4240613c2d565b9450615196565b6002818115156150d357fe5b056203d09001620f42406150e5613fad565b63ffffffff168115156150f457fe5b0663ffffffff1612156151365761512f6151186151128d8d8d614ebc565b83613bef565b60028381151561512457fe5b056203d09001613c2d565b9450615196565b61519361517c6151716080604051908101604052808e81526020018781526020018f6040015181526020018f60600151151515815250614004565b83620f424003613bef565b60028381151561518857fe5b05620b71b003613c2d565b94505b505050509695505050505050565b6000808213156151b6578190506151bd565b8160000390505b919050565b6000806151ce836151ea565b90506151e281820264e8d4a5100003613f62565b915050919050565b60008060008060005b600086121561520957625fdfb0860195506151f3565b5b625fdfb08612151561522357625fdfb08603955061520a565b6001935085925060019150600290505b818313156152a7578183850281151561524857fe5b0585019450620f424080878886020281151561526057fe5b0581151561526a57fe5b059250600181018102820291507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff84029350600281019050615233565b50505050919050565\
    b610260604051908101604052806152c56153c6565b81526020016152d26153c6565b81526020016152df6153c6565b81526020016152ec6153c6565b81526020016152f96153c6565b81526020016153066153c6565b81526020016000600281111561531857fe5b81525090565b6060604051908101604052806000815260200160008152602001600081525090565b610100604051908101604052806153556153c6565b81526020016153626153c6565b8152602001600081526020016000151581525090565b61016060405190810160405280600081526020016153946153c6565b81526020016153a16153c6565b81526020016153ae6153c6565b8152602001600060028111156153c057fe5b81525090565b60606040519081016040528060008152602001600081526020016000815250905600a165627a7a72305820194f384f1a7a2c122c5fb33da1e9c7053f3504de564bccf077da8b2d294aee190029";

pub fn run_with_levm(program: &str, runs: usize, number_of_iterations: u32) {
    let bytecode = Bytes::from(hex::decode(program).unwrap());
    let mut call_frame = CallFrame::new_from_bytecode(bytecode);
    let mut calldata = vec![0x00; 32];
    calldata[28..32].copy_from_slice(&number_of_iterations.to_be_bytes());
    call_frame.calldata = Bytes::from(calldata);

    for _ in 0..runs - 1 {
        let mut vm = new_vm_with_bytecode(Bytes::new()).unwrap();
        *vm.current_call_frame_mut().unwrap() = call_frame.clone();
        let mut current_call_frame = vm.call_frames.pop().unwrap();
        let tx_report = black_box(vm.execute(&mut current_call_frame).unwrap());
        assert!(tx_report.result == TxResult::Success);
    }
    let mut vm = new_vm_with_bytecode(Bytes::new()).unwrap();
    *vm.current_call_frame_mut().unwrap() = call_frame.clone();
    let mut current_call_frame = vm.call_frames.pop().unwrap();
    let tx_report = black_box(vm.execute(&mut current_call_frame).unwrap());
    assert!(tx_report.result == TxResult::Success);

    match tx_report.result {
        TxResult::Success => {
            println!("\t\t0x{}", hex::encode(current_call_frame.output));
        }
        TxResult::Revert(error) => panic!("Execution failed: {:?}", error),
    }
}

pub fn run_with_revm(program: &str, runs: usize, number_of_iterations: u32) {
    let bytes = hex::decode(program).unwrap();
    let raw = Bytecode::new_raw(bytes.into());
    let mut calldata = [0; 32];
    calldata[28..32].copy_from_slice(&number_of_iterations.to_be_bytes());
    let mut evm = Evm::builder()
        .with_db(BenchmarkDB::new_bytecode(raw))
        .modify_tx_env(|tx| {
            tx.caller = address!("1000000000000000000000000000000000000000");
            tx.transact_to = TransactTo::Call(address!("0000000000000000000000000000000000000000"));
            tx.data = calldata.into();
        })
        .build();

    for _ in 0..runs - 1 {
        let result = black_box(evm.transact()).unwrap();
        assert!(result.result.is_success());
    }
    let result = black_box(evm.transact()).unwrap();
    assert!(result.result.is_success());

    println!("\t\t{}", result.result.into_output().unwrap());
}

pub fn run_with_levm_calldata(program: &str, runs: usize, calldata: &str) {
    let bytecode = Bytes::from(hex::decode(program).unwrap());
    let mut call_frame = CallFrame::new_from_bytecode(bytecode);
    call_frame.calldata = Bytes::from(hex::decode(calldata).unwrap());

    for _ in 0..runs - 1 {
        let mut vm = new_vm_with_bytecode(Bytes::new()).unwrap();
        *vm.current_call_frame_mut().unwrap() = call_frame.clone();
        let mut current_call_frame = vm.call_frames.pop().unwrap();
        let tx_report = black_box(vm.execute(&mut current_call_frame).unwrap());
        assert!(tx_report.result == TxResult::Success);
    }
    let mut vm = new_vm_with_bytecode(Bytes::new()).unwrap();
    *vm.current_call_frame_mut().unwrap() = call_frame.clone();
    let mut current_call_frame = vm.call_frames.pop().unwrap();
    let tx_report = black_box(vm.execute(&mut current_call_frame).unwrap());
    assert!(tx_report.result == TxResult::Success);

    match tx_report.result {
        TxResult::Success => {
            println!("\t\t0x{}", hex::encode(current_call_frame.output));
        }
        TxResult::Revert(error) => panic!("Execution failed: {:?}", error),
    }
}

pub fn run_with_revm_calldata(program: &str, runs: usize, calldata: &str) {
    let bytes = hex::decode(program).unwrap();
    let raw = Bytecode::new_raw(bytes.into());
    let mut evm = Evm::builder()
        .with_db(BenchmarkDB::new_bytecode(raw))
        .modify_tx_env(|tx| {
            tx.caller = address!("1000000000000000000000000000000000000000");
            tx.transact_to = TransactTo::Call(address!("0000000000000000000000000000000000000000"));
            tx.data = hex::decode(calldata).unwrap().into();
        })
        .build();

    for _ in 0..runs - 1 {
        let result = black_box(evm.transact()).unwrap();
        assert!(result.result.is_success());
    }
    let result = black_box(evm.transact()).unwrap();
    assert!(result.result.is_success());

    println!("\t\t{}", result.result.into_output().unwrap());
}
