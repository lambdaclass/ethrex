[package]
name = "guest_program"
version.workspace = true
edition.workspace = true
authors.workspace = true
documentation.workspace = true

[dependencies]
serde = { version = "1.0.203", features = ["derive"] }
serde_with.workspace = true
serde_json = "1.0.117"
thiserror = "2.0.9"
rkyv.workspace = true
bytes.workspace = true

ethrex-common = { path = "../../../../common/", default-features = false }
ethrex-crypto = { path = "../../../../common/crypto", default-features = false }
ethrex-blockchain = { path = "../../../../blockchain/", default-features = false }
ethrex-vm = { path = "../../../../vm", default-features = false }
ethrex-trie = { path = "../../../../common/trie", default-features = false }
ethrex-l2-common = { path = "../../../common", default-features = false }

[build-dependencies]
hex.workspace = true
risc0-build = { version = "=3.0.3", optional = true }
risc0-zkvm = { version = "=3.0.3", optional = true, features = ["getrandom"] }
sp1-build = { version = "=5.0.8", optional = true }
sp1-sdk = { version = "=5.0.8", optional = true }

[package.metadata.risc0]
methods = ["src/risc0"]

[features]
# Features for guest programs #
# =========================== #
# * secp256k1
# * k256
# * c-kzg
# * kzg-rs
#
# Mutually exclusive features #
# =========================== #
# * secp256k1 & k256
# * c-kzg & kzg-rs
#
# Caution #
# ======= #
# The features sp1 and risc0 are not meant to be enabled whithin the guest programs.
# Enabling this features within the guests will cause them to not compile.
# These are only to lower the dev's compilation overhead.

default = ["l1"]

secp256k1 = [
    "ethrex-vm/secp256k1",
    "ethrex-l2-common/secp256k1",
    "ethrex-common/secp256k1",
]
k256 = ["ethrex-vm/k256", "ethrex-l2-common/k256", "ethrex-common/k256"]

c-kzg = [
    "ethrex-vm/c-kzg",
    "ethrex-common/c-kzg",
    "ethrex-blockchain/c-kzg",
    "ethrex-crypto/c-kzg",
    "ethrex-l2-common/c-kzg",
]
kzg-rs = [
    "ethrex-vm/kzg-rs",
    "ethrex-common/kzg-rs",
    "ethrex-blockchain/kzg-rs",
    "ethrex-crypto/kzg-rs",
    "ethrex-l2-common/kzg-rs",
]

l1 = [
    "ethrex-vm/l1",
    "ethrex-common/l1",
    "ethrex-blockchain/l1",
    "ethrex-crypto/l1",
    "ethrex-l2-common/l1",
]

# This feature enables the SP1's guest program ELF compilation.
# This feature mustn't be enabled whithin a guest program.
sp1-guest = ["dep:sp1-build", "dep:sp1-sdk"]
# This feature enables the RISC0's guest program ELF compilation.
# This feature mustn't be enabled whithin a guest program.
risc0-guest = ["dep:risc0-build", "dep:risc0-zkvm"]

# This feature is meant to be enabled within SP1's guest program.
# Enabling this feature ensures the optimal compilation for SP1's guest.
sp1 = [
    "ethrex-vm/sp1",
    "ethrex-common/sp1",
    "ethrex-blockchain/sp1",
    "ethrex-crypto/sp1",
    "ethrex-l2-common/sp1",
]
# This feature is meant to be enabled within RISC0's guest program.
# Enabling this feature ensures the optimal compilation for RISC0's guest.
risc0 = [
    "ethrex-vm/risc0",
    "ethrex-common/risc0",
    "ethrex-blockchain/risc0",
    "ethrex-crypto/risc0",
    "ethrex-l2-common/risc0",
]

l2 = []

[lib]
path = "./src/lib.rs"
